<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PhoneBillGwt.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Phone Bill GWT Application</a> &gt; <a href="index.source.html" class="el_package">edu.pdx.cs410J.cox.client</a> &gt; <span class="el_source">PhoneBillGwt.java</span></div><h1>PhoneBillGwt.java</h1><pre class="source lang-java linenums">package edu.pdx.cs410J.cox.client;

import com.google.common.annotations.VisibleForTesting;
import com.google.gwt.core.client.EntryPoint;
import com.google.gwt.core.client.GWT;
import com.google.gwt.core.client.Scheduler;
import com.google.gwt.event.dom.client.ClickEvent;
import com.google.gwt.event.dom.client.ClickHandler;
import com.google.gwt.event.shared.UmbrellaException;
import com.google.gwt.user.client.Window;
import com.google.gwt.user.client.rpc.AsyncCallback;
import com.google.gwt.user.client.ui.Button;
import com.google.gwt.user.client.ui.RootPanel;
import com.google.gwt.user.client.ui.VerticalPanel;
import com.google.gwt.user.client.ui.TextBox;
import com.google.gwt.user.client.ui.TextArea;
import com.google.gwt.user.client.ui.Label;
import com.google.gwt.user.client.ui.FlexTable;
import com.google.gwt.user.client.ui.VerticalPanel;

import java.util.Collection;
import java.util.logging.Level;
import java.util.logging.Logger;

/**
 * A basic GWT class that makes sure that we can send an Phone Bill back from the server
 */
public class PhoneBillGwt implements EntryPoint {
  private final Alerter alerter;
  private final PhoneBillServiceAsync phoneBillService;
  private final Logger logger;
<span class="nc" id="L32">  private PhoneBill bill = new PhoneBill();</span>
<span class="nc" id="L33">  private String selectedOption = &quot;add&quot;;</span>
  

  @VisibleForTesting
  Button showPhoneBillButton;

  @VisibleForTesting
  Button showUndeclaredExceptionButton;

  @VisibleForTesting
  Button showDeclaredExceptionButton;

  @VisibleForTesting
  Button showClientSideExceptionButton;

  @VisibleForTesting
  FlexTable wholeTable, helpMenuTable, applicationTable, optionButtonsTable;

  @VisibleForTesting
  Label topLineLabel;

  @VisibleForTesting
  VerticalPanel linePanel; Label lineLabel1, lineLabel2, lineLabel3, lineLabel4, lineLabel5, lineLabel6, lineLabel7, lineLabel8, lineLabel9, lineLabel10, lineLabel11, lineLabel12, lineLabel13, lineLabel14, lineLabel15;

  @VisibleForTesting
  Label helpMenuLabel, applicationLabel; Button readmeButton;

  @VisibleForTesting
  Button addCallButton, searchBillButton, prettyPrintBillButton;

  @VisibleForTesting
  FlexTable inputsTable;

  @VisibleForTesting
  Label customerLabel, callerLabel, calleeLabel, startLabel, endLabel;

  @VisibleForTesting
  TextBox customerNameInput, callerNumberInput, calleeNumberInput, addStartTimeInput, addEndTimeInput;

  @VisibleForTesting
  FlexTable submitOrClearButtonsTable;

  @VisibleForTesting
  Button submitRequestButton, clearAllInputsButton;

  @VisibleForTesting
  TextArea billResultsTextarea;


  public PhoneBillGwt() {
<span class="nc" id="L83">    this(new Alerter() {</span>
      @Override
      public void alert(String message) {
<span class="nc" id="L86">        Window.alert(message);</span>
<span class="nc" id="L87">      }</span>
    });
<span class="nc" id="L89">  }</span>

  @VisibleForTesting
<span class="nc" id="L92">  PhoneBillGwt(Alerter alerter) {</span>
<span class="nc" id="L93">    this.alerter = alerter;</span>
<span class="nc" id="L94">    this.phoneBillService = GWT.create(PhoneBillService.class);</span>
<span class="nc" id="L95">    this.logger = Logger.getLogger(&quot;phoneBill&quot;);</span>
<span class="nc" id="L96">    Logger.getLogger(&quot;&quot;).setLevel(Level.INFO);  // Quiet down the default logging</span>
<span class="nc" id="L97">  }</span>

  private void alertOnException(Throwable throwable) {
<span class="nc" id="L100">    Throwable unwrapped = unwrapUmbrellaException(throwable);</span>
<span class="nc" id="L101">    StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L102">    sb.append(unwrapped.toString());</span>
<span class="nc" id="L103">    sb.append('\n');</span>

<span class="nc bnc" id="L105" title="All 2 branches missed.">    for (StackTraceElement element : unwrapped.getStackTrace()) {</span>
<span class="nc" id="L106">      sb.append(&quot;  at &quot;);</span>
<span class="nc" id="L107">      sb.append(element.toString());</span>
<span class="nc" id="L108">      sb.append('\n');</span>
    }

<span class="nc" id="L111">    this.alerter.alert(sb.toString());</span>
<span class="nc" id="L112">  }</span>

  private Throwable unwrapUmbrellaException(Throwable throwable) {
<span class="nc bnc" id="L115" title="All 2 branches missed.">    if (throwable instanceof UmbrellaException) {</span>
<span class="nc" id="L116">      UmbrellaException umbrella = (UmbrellaException) throwable;</span>
<span class="nc bnc" id="L117" title="All 2 branches missed.">      if (umbrella.getCauses().size() == 1) {</span>
<span class="nc" id="L118">        return unwrapUmbrellaException(umbrella.getCauses().iterator().next());</span>
      }

    }

<span class="nc" id="L123">    return throwable;</span>
  }

  private void addWidgets(VerticalPanel panel) {
<span class="nc" id="L127">    final String readme = &quot;\n\n -- README --\n&quot; +</span>
            &quot;\nProject 5 implemented by Lily Cox \n&quot; +
            &quot;This program creates phone bills from phone call information.&quot; +
            &quot;There are three main options for interacting with the phonebill application: 'Add a Call', 'Search Bill', and 'Print Bill'.&quot; +
            &quot;When one of these options is selected, the relevant textboxes will be made visible. The selected option's button will become disabled (grayed out and&quot;+
            &quot;non clickable) to indicate that that is the option that is currently selected. 'Add a Call' is selected by default.&quot;+
            &quot;Each piece of data entered into the text boxes is checked to make sure it adheres to the expected formatting.&quot; +
            &quot;If any information is formatted incorrectly, an alert will pop up stating which textboxes are formatted incorrectly.&quot; +
            &quot;No calls will be added, or searches will be conducted if any of the information is formatted incorrectly.&quot;+
            &quot;If all of the entered data was formatted correctly, the information will be added to an instance of the&quot; +
            &quot;PhoneCall class, and that instance added to the specified customer's bill.&quot; +
            &quot;If a new call is being added, and the included customer does not exist, a bill will be created for them.&quot; +
            &quot;If the customer provided to 'Search Bill' or 'Print Bill' does not exist on the server, an alert message will be displayed to the user.&quot; +
            &quot;For 'Add a Call', the customer name, caller number, callee number, start time, and end time are accepted. A new call&quot; +
            &quot;will be created for the customer's bill from this information. If the customer does not already exist, it will be created.&quot;+
            &quot;For 'Search Bill', a customer name, start time, and end time are accepted, and all calls from that customer's bill that fall&quot; +
            &quot;within that time period will be pretty printed in an alert popup.&quot; +
            &quot;For 'Print Bill', it accepts just a customer name. It will pretty print that customer's bill to an alert popup for the user.&quot;+
            &quot;To send the 'Add a Call', 'Search Bill', or 'Print Bill' requests to the server, fill out all provided text boxes, and click the 'SUBMIT' button below the text bozes.&quot; +
            &quot;Clicking 'Empty Textboxes' will delete all information you have put in the textboxes.&quot;;

<span class="nc" id="L148">    showPhoneBillButton = new Button(&quot;Show Phone Bill&quot;);</span>
<span class="nc" id="L149">    showPhoneBillButton.addClickHandler(new ClickHandler() {</span>
      @Override
      public void onClick(ClickEvent clickEvent) {
<span class="nc" id="L152">        showPhoneBill();</span>
<span class="nc" id="L153">      }</span>
    });

<span class="nc" id="L156">    showUndeclaredExceptionButton = new Button(&quot;Show undeclared exception&quot;);</span>
<span class="nc" id="L157">    showUndeclaredExceptionButton.addClickHandler(new ClickHandler() {</span>
      @Override
      public void onClick(ClickEvent clickEvent) {
<span class="nc" id="L160">        showUndeclaredException();</span>
<span class="nc" id="L161">      }</span>
    });

<span class="nc" id="L164">    showDeclaredExceptionButton = new Button(&quot;Show declared exception&quot;);</span>
<span class="nc" id="L165">    showDeclaredExceptionButton.addClickHandler(new ClickHandler() {</span>
      @Override
      public void onClick(ClickEvent clickEvent) {
<span class="nc" id="L168">        showDeclaredException();</span>
<span class="nc" id="L169">      }</span>
    });

<span class="nc" id="L172">    showClientSideExceptionButton= new Button(&quot;Show client-side exception&quot;);</span>
<span class="nc" id="L173">    showClientSideExceptionButton.addClickHandler(new ClickHandler() {</span>
      @Override
      public void onClick(ClickEvent clickEvent) {
<span class="nc" id="L176">        throwClientSideException();</span>
<span class="nc" id="L177">      }</span>
    });

<span class="nc" id="L180">    addCallButton= new Button(&quot;Add a Call&quot;);</span>
<span class="nc" id="L181">    addCallButton.addClickHandler( new ClickHandler () {</span>
      @Override
<span class="nc" id="L183">      public void onClick(ClickEvent clickEvent) {selectedOption=&quot;add&quot;;setForAdd();}</span>
    });
<span class="nc" id="L185">    addCallButton.setEnabled(false);</span>

<span class="nc" id="L187">    searchBillButton= new Button(&quot;Search Bill&quot;);</span>
<span class="nc" id="L188">    searchBillButton.addClickHandler( new ClickHandler () {</span>
      @Override
<span class="nc" id="L190">      public void onClick(ClickEvent clickEvent) {selectedOption=&quot;search&quot;;setForSearch();}</span>
    });

 /*   readme
    validating information
    feedback reasonable and coherant
      can add multiple calls and multiple bills



      Final Exam: on comp: 7:57
      Essentially two quizes put together
      Covers what was in the programs
      Timed: 40 minutes to do 6 questions
      Open book and sources, but no electronics
      What apis look like and how to use them

      First part is individual
      Second part is group
      */

<span class="nc" id="L211">    prettyPrintBillButton= new Button(&quot;Print Bill&quot;);</span>
<span class="nc" id="L212">    prettyPrintBillButton.addClickHandler(new ClickHandler() {</span>
      @Override
<span class="nc" id="L214">      public void onClick(ClickEvent clickEvent) {selectedOption=&quot;print&quot;;setForPrint();}</span>
    });

<span class="nc" id="L217">    submitRequestButton = new Button (&quot;SUBMIT&quot;);</span>
<span class="nc" id="L218">    submitRequestButton.addClickHandler(new ClickHandler () {</span>
        @Override
        public void onClick(ClickEvent clickEvent) {
<span class="nc bnc" id="L221" title="All 4 branches missed.">            switch (selectedOption) {</span>
                case &quot;add&quot;:
<span class="nc" id="L223">                    addCall(clickEvent);</span>
<span class="nc" id="L224">                    break;</span>
                case &quot;search&quot;:
<span class="nc" id="L226">                    searchBill(clickEvent);</span>
<span class="nc" id="L227">                    break;</span>
                case &quot;print&quot;:
<span class="nc" id="L229">                    printBill(clickEvent);</span>
                    break;
            }
<span class="nc" id="L232">        }</span>
    });

<span class="nc" id="L235">    clearAllInputsButton = new Button (&quot;Empty Textboxes&quot;);</span>
<span class="nc" id="L236">    clearAllInputsButton.addClickHandler(new ClickHandler () {</span>
      @Override
      public void onClick(ClickEvent clickEvent) {
<span class="nc" id="L239">       customerNameInput.setValue(&quot;&quot;);</span>
<span class="nc" id="L240">       callerNumberInput.setValue(&quot;&quot;);</span>
<span class="nc" id="L241">       calleeNumberInput.setValue(&quot;&quot;);</span>
<span class="nc" id="L242">       addStartTimeInput.setValue(&quot;&quot;);</span>
<span class="nc" id="L243">       addEndTimeInput.setValue(&quot;&quot;);</span>
<span class="nc" id="L244">      }</span>
    });

<span class="nc" id="L247">    helpMenuTable = new FlexTable();</span>

<span class="nc" id="L249">    helpMenuLabel = new Label(&quot;Help Menu&quot;);</span>
<span class="nc" id="L250">    helpMenuLabel.getElement().getStyle().setProperty(&quot;fontSize&quot;,&quot;17px&quot;);</span>
<span class="nc" id="L251">    helpMenuLabel.getElement().getStyle().setProperty(&quot;fontWeight&quot;,&quot;bold&quot;);</span>

<span class="nc" id="L253">    readmeButton = new Button(&quot;Readme&quot;);</span>
<span class="nc" id="L254">    readmeButton.addClickHandler(new ClickHandler () {</span>
      @Override
      public void onClick(ClickEvent clickEvent) {
<span class="nc" id="L257">        alerter.alert(readme);</span>
<span class="nc" id="L258">      }</span>
    });

<span class="nc" id="L261">    helpMenuTable.setWidget(0,0,helpMenuLabel);</span>
<span class="nc" id="L262">    helpMenuTable.setText(1, 0, &quot; &quot;);</span>
<span class="nc" id="L263">    helpMenuTable.setWidget(2, 0, readmeButton);</span>
<span class="nc" id="L264">    helpMenuTable.getElement().getStyle().setProperty(&quot;position&quot;, &quot;absolute&quot;);</span>
<span class="nc" id="L265">    helpMenuTable.getElement().getStyle().setProperty(&quot;left&quot;, &quot;10px&quot;);</span>
<span class="nc" id="L266">    helpMenuTable.getElement().getStyle().setProperty(&quot;top&quot;, &quot;20px&quot;);</span>

<span class="nc" id="L268">    topLineLabel = new Label(&quot;---------------------------------------------------------------------------------------------&quot;);</span>
<span class="nc" id="L269">    topLineLabel.getElement().getStyle().setProperty(&quot;position&quot;,&quot;absolute&quot;);</span>
<span class="nc" id="L270">    topLineLabel.getElement().getStyle().setProperty(&quot;top&quot;,&quot;35px&quot;);</span>


<span class="nc" id="L273">    linePanel = new VerticalPanel();</span>
<span class="nc" id="L274">    lineLabel1 = new Label(&quot;|&quot;);</span>
<span class="nc" id="L275">    lineLabel2 = new Label(&quot;|&quot;);</span>
<span class="nc" id="L276">    lineLabel3 = new Label(&quot;|&quot;);</span>
<span class="nc" id="L277">    lineLabel4 = new Label(&quot;|&quot;);</span>
<span class="nc" id="L278">    lineLabel5 = new Label(&quot;|&quot;);</span>
<span class="nc" id="L279">    lineLabel6 = new Label(&quot;|&quot;);</span>
<span class="nc" id="L280">    lineLabel7 = new Label(&quot;|&quot;);</span>
<span class="nc" id="L281">    lineLabel8 = new Label(&quot;|&quot;);</span>
<span class="nc" id="L282">    lineLabel9 = new Label(&quot;|&quot;);</span>
<span class="nc" id="L283">    lineLabel10 = new Label(&quot;|&quot;);</span>
<span class="nc" id="L284">    lineLabel11 = new Label(&quot;|&quot;);</span>
<span class="nc" id="L285">    lineLabel12 = new Label(&quot;|&quot;);</span>
<span class="nc" id="L286">    lineLabel13 = new Label(&quot;|&quot;);</span>
<span class="nc" id="L287">    lineLabel14 = new Label(&quot;|&quot;);</span>
<span class="nc" id="L288">    lineLabel15 = new Label(&quot;|&quot;);</span>

<span class="nc" id="L290">    linePanel.add(lineLabel1);</span>
<span class="nc" id="L291">    linePanel.add(lineLabel2);</span>
<span class="nc" id="L292">    linePanel.add(lineLabel3);</span>
<span class="nc" id="L293">    linePanel.add(lineLabel4);</span>
<span class="nc" id="L294">    linePanel.add(lineLabel5);</span>
<span class="nc" id="L295">    linePanel.add(lineLabel6);</span>
<span class="nc" id="L296">    linePanel.add(lineLabel7);</span>
<span class="nc" id="L297">    linePanel.add(lineLabel8);</span>
<span class="nc" id="L298">    linePanel.add(lineLabel9);</span>
<span class="nc" id="L299">    linePanel.add(lineLabel10);</span>
<span class="nc" id="L300">    linePanel.add(lineLabel11);</span>
<span class="nc" id="L301">    linePanel.add(lineLabel12);</span>
<span class="nc" id="L302">    linePanel.add(lineLabel13);</span>
<span class="nc" id="L303">    linePanel.add(lineLabel14);</span>
<span class="nc" id="L304">    linePanel.add(lineLabel15);</span>
<span class="nc" id="L305">    linePanel.getElement().getStyle().setProperty(&quot;position&quot;, &quot;absolute&quot;);</span>
<span class="nc" id="L306">    linePanel.getElement().getStyle().setProperty(&quot;left&quot;, &quot;110px&quot;);</span>
<span class="nc" id="L307">    linePanel.getElement().getStyle().setProperty(&quot;top&quot;, &quot;23px&quot;);</span>

<span class="nc" id="L309">    applicationTable = new FlexTable();</span>
<span class="nc" id="L310">    optionButtonsTable = new FlexTable();</span>
<span class="nc" id="L311">    optionButtonsTable.setWidget(0,0, addCallButton);</span>
<span class="nc" id="L312">    optionButtonsTable.setWidget(0, 1, searchBillButton);</span>
<span class="nc" id="L313">    optionButtonsTable.setWidget(0, 2, prettyPrintBillButton);</span>

<span class="nc" id="L315">    customerLabel = new Label(&quot;Customer Name: &quot;);</span>
<span class="nc" id="L316">    callerLabel = new Label(&quot;Caller Number: &quot;);</span>
<span class="nc" id="L317">    calleeLabel = new Label(&quot;Callee Number: &quot;);</span>
<span class="nc" id="L318">    startLabel = new Label(&quot;Start Time: &quot;);</span>
<span class="nc" id="L319">    endLabel = new Label(&quot;End Time: &quot;);</span>

<span class="nc" id="L321">    customerNameInput = new TextBox();</span>
<span class="nc" id="L322">    callerNumberInput = new TextBox();</span>
<span class="nc" id="L323">    calleeNumberInput = new TextBox();</span>
<span class="nc" id="L324">    addStartTimeInput = new TextBox();</span>
<span class="nc" id="L325">    addEndTimeInput = new TextBox();</span>

<span class="nc" id="L327">    inputsTable = new FlexTable();</span>
<span class="nc" id="L328">    inputsTable.setWidget(0, 0, customerLabel);</span>
<span class="nc" id="L329">    inputsTable.setWidget(0, 1, customerNameInput);</span>
<span class="nc" id="L330">    inputsTable.setWidget(1,0, callerLabel);</span>
<span class="nc" id="L331">    inputsTable.setWidget(1,1, callerNumberInput);</span>
<span class="nc" id="L332">    inputsTable.setWidget(2,0,calleeLabel);</span>
<span class="nc" id="L333">    inputsTable.setWidget(2,1,calleeNumberInput);</span>
<span class="nc" id="L334">    inputsTable.setWidget(3,0,startLabel);</span>
<span class="nc" id="L335">    inputsTable.setWidget(3,1,addStartTimeInput);</span>
<span class="nc" id="L336">    inputsTable.setWidget(4,0,endLabel);</span>
<span class="nc" id="L337">    inputsTable.setWidget(4,1,addEndTimeInput);</span>

<span class="nc" id="L339">    submitOrClearButtonsTable = new FlexTable();</span>
<span class="nc" id="L340">    submitOrClearButtonsTable.setWidget(0, 0, submitRequestButton);</span>
<span class="nc" id="L341">    submitOrClearButtonsTable.setWidget(0,1,clearAllInputsButton);</span>

<span class="nc" id="L343">    applicationLabel = new Label(&quot;Application&quot;);</span>
<span class="nc" id="L344">    applicationLabel.getElement().getStyle().setProperty(&quot;fontSize&quot;,&quot;17px&quot;);</span>
<span class="nc" id="L345">    applicationLabel.getElement().getStyle().setProperty(&quot;fontWeight&quot;, &quot;bold&quot;);</span>

<span class="nc" id="L347">    applicationTable.setWidget(0,0, applicationLabel);</span>
<span class="nc" id="L348">    applicationTable.setText(1,0,&quot; &quot;);</span>
<span class="nc" id="L349">    applicationTable.setWidget(2, 0, optionButtonsTable);</span>
<span class="nc" id="L350">    applicationTable.setWidget(4, 0, inputsTable);</span>
<span class="nc" id="L351">    applicationTable.setWidget(6, 0, submitOrClearButtonsTable);</span>
<span class="nc" id="L352">    applicationTable.getElement().getStyle().setProperty(&quot;position&quot;, &quot;absolute&quot;);</span>
<span class="nc" id="L353">    applicationTable.getElement().getStyle().setProperty(&quot;left&quot;, &quot;130px&quot;);</span>
<span class="nc" id="L354">    applicationTable.getElement().getStyle().setProperty(&quot;top&quot;, &quot;20px&quot;);</span>

<span class="nc" id="L356">    billResultsTextarea = new TextArea();</span>
<span class="nc" id="L357">    billResultsTextarea.setWidth(&quot;270px&quot;);</span>
<span class="nc" id="L358">    billResultsTextarea.setHeight(&quot;250px&quot;);</span>
<span class="nc" id="L359">    billResultsTextarea.setVisible(false);</span>
<span class="nc" id="L360">    billResultsTextarea.setReadOnly(true);</span>

<span class="nc" id="L362">    applicationTable.setWidget(8,0,billResultsTextarea);</span>

<span class="nc" id="L364">    wholeTable = new FlexTable();</span>
  /*  wholeTable.setWidget(0, 0, helpMenuLabel);
    wholeTable.setWidget(0, 1, optionButtonsTable);
    wholeTable.setWidget(1, 0, readmeButton);
    wholeTable.setWidget(1, 1, inputsTable);
    wholeTable.setWidget(2, 1, submitOrClearButtonsTable);*/

   /* wholeTable.setWidget(1, 1, helpMenuLabel);
    wholeTable.setText(1,3,&quot;|&quot;);
    wholeTable.setText(1,5,&quot;Application&quot;);



    wholeTable.setText(2,1,&quot;-------------------&quot;);
    wholeTable.setText(2,3,&quot;|&quot;);
    wholeTable.setText(2,5,&quot;------------------------------------------------------------------------&quot;);

    wholeTable.setWidget(3, 1, readmeButton);
    wholeTable.setText(3,3,&quot;|&quot;);
    wholeTable.setWidget(3, 5, optionButtonsTable);

    wholeTable.setText(4,3,&quot;|&quot;);

    wholeTable.setWidget(5,3,linePanel);
    wholeTable.setWidget(5, 5, inputsTable);

    wholeTable.setText(6,3,&quot;|&quot;);

    wholeTable.setText(7,3,&quot;|&quot;);
    wholeTable.setWidget(7, 5, submitOrClearButtonsTable);*/

<span class="nc" id="L395">    wholeTable.setWidget(1, 1, helpMenuTable);</span>
<span class="nc" id="L396">    wholeTable.setWidget(1, 3, linePanel);</span>
<span class="nc" id="L397">    wholeTable.setWidget(1, 5, applicationTable);</span>

<span class="nc" id="L399">    panel.add(wholeTable);</span>
<span class="nc" id="L400">    panel.add(topLineLabel);</span>
<span class="nc" id="L401">  }</span>

  private void throwClientSideException() {
<span class="nc" id="L404">    logger.info(&quot;About to throw a client-side exception&quot;);</span>
<span class="nc" id="L405">    throw new IllegalStateException(&quot;Expected exception on the client side&quot;);</span>
  }

  private void showUndeclaredException() {
<span class="nc" id="L409">    logger.info(&quot;Calling throwUndeclaredException&quot;);</span>
<span class="nc" id="L410">    phoneBillService.throwUndeclaredException(new AsyncCallback&lt;Void&gt;() {</span>
      @Override
      public void onFailure(Throwable ex) {
<span class="nc" id="L413">        alertOnException(ex);</span>
<span class="nc" id="L414">      }</span>

      @Override
      public void onSuccess(Void aVoid) {
<span class="nc" id="L418">        alerter.alert(&quot;This shouldn't happen&quot;);</span>
<span class="nc" id="L419">      }</span>
    });
<span class="nc" id="L421">  }</span>

  private void showDeclaredException() {
<span class="nc" id="L424">    logger.info(&quot;Calling throwDeclaredException&quot;);</span>
<span class="nc" id="L425">    phoneBillService.throwDeclaredException(new AsyncCallback&lt;Void&gt;() {</span>
      @Override
      public void onFailure(Throwable ex) {
<span class="nc" id="L428">        alertOnException(ex);</span>
<span class="nc" id="L429">      }</span>

      @Override
      public void onSuccess(Void aVoid) {
<span class="nc" id="L433">        alerter.alert(&quot;This shouldn't happen&quot;);</span>
<span class="nc" id="L434">      }</span>
    });
<span class="nc" id="L436">  }</span>

  private void showPhoneBill() {
<span class="nc" id="L439">    logger.info(&quot;Calling getPhoneBill&quot;);</span>
<span class="nc" id="L440">    phoneBillService.getPhoneBill(new AsyncCallback&lt;PhoneBill&gt;() {</span>

      @Override
      public void onFailure(Throwable ex) {
<span class="nc" id="L444">        alertOnException(ex);</span>
<span class="nc" id="L445">      }</span>

      @Override
      public void onSuccess(PhoneBill phoneBill) {
<span class="nc" id="L449">        StringBuilder sb = new StringBuilder(phoneBill.toString());</span>
<span class="nc" id="L450">        Collection&lt;PhoneCall&gt; calls = phoneBill.getPhoneCalls();</span>
<span class="nc bnc" id="L451" title="All 2 branches missed.">        for (PhoneCall call : calls) {</span>
<span class="nc" id="L452">          sb.append(call);</span>
<span class="nc" id="L453">          sb.append(&quot;\n&quot;);</span>
<span class="nc" id="L454">        }</span>
<span class="nc" id="L455">        alerter.alert(sb.toString());</span>
<span class="nc" id="L456">      }</span>
    });
<span class="nc" id="L458">  }</span>
  
  @Override
  public void onModuleLoad() {
<span class="nc" id="L462">    setUpUncaughtExceptionHandler();</span>

    // The UncaughtExceptionHandler won't catch exceptions during module load
    // So, you have to set up the UI after module load...
<span class="nc" id="L466">    Scheduler.get().scheduleDeferred(new Scheduler.ScheduledCommand() {</span>
      @Override
      public void execute() {
<span class="nc" id="L469">        setupUI();</span>
<span class="nc" id="L470">      }</span>
    });
<span class="nc" id="L472">  }</span>


  private void setupUI() {
<span class="nc" id="L476">    RootPanel rootPanel = RootPanel.get();</span>
<span class="nc" id="L477">    VerticalPanel panel = new VerticalPanel();</span>
<span class="nc" id="L478">    rootPanel.add(panel);</span>

<span class="nc" id="L480">    addWidgets(panel);</span>
<span class="nc" id="L481">  }</span>

  private void setUpUncaughtExceptionHandler() {
<span class="nc" id="L484">    GWT.setUncaughtExceptionHandler(new GWT.UncaughtExceptionHandler() {</span>
      @Override
      public void onUncaughtException(Throwable throwable) {
<span class="nc" id="L487">        alertOnException(throwable);</span>
<span class="nc" id="L488">      }</span>
    });
<span class="nc" id="L490">  }</span>

  @VisibleForTesting
  interface Alerter {
    void alert(String message);
  }

  public void setForAdd () {
<span class="nc" id="L498">    addCallButton.setEnabled(false);</span>
<span class="nc" id="L499">    searchBillButton.setEnabled(true);</span>
<span class="nc" id="L500">    prettyPrintBillButton.setEnabled(true);</span>

<span class="nc" id="L502">    customerNameInput.setVisible(true);</span>
<span class="nc" id="L503">    customerLabel.setVisible(true);</span>

<span class="nc" id="L505">    callerNumberInput.setVisible(true);</span>
<span class="nc" id="L506">    callerLabel.setVisible(true);</span>

<span class="nc" id="L508">    calleeNumberInput.setVisible(true);</span>
<span class="nc" id="L509">    calleeLabel.setVisible(true);</span>

<span class="nc" id="L511">    addStartTimeInput.setVisible(true);</span>
<span class="nc" id="L512">    startLabel.setVisible(true);</span>

<span class="nc" id="L514">    addEndTimeInput.setVisible(true);</span>
<span class="nc" id="L515">    endLabel.setVisible(true);</span>

<span class="nc" id="L517">    billResultsTextarea.setVisible(false);</span>
<span class="nc" id="L518">    billResultsTextarea.setValue(&quot;&quot;);</span>
<span class="nc" id="L519">  }</span>

  public void setForSearch () {
<span class="nc" id="L522">    addCallButton.setEnabled(true);</span>
<span class="nc" id="L523">    searchBillButton.setEnabled(false);</span>
<span class="nc" id="L524">    prettyPrintBillButton.setEnabled(true);</span>

<span class="nc" id="L526">    customerNameInput.setVisible(true);</span>
<span class="nc" id="L527">    customerLabel.setVisible(true);</span>

<span class="nc" id="L529">    callerNumberInput.setVisible(false);</span>
<span class="nc" id="L530">    callerLabel.setVisible(false);</span>

<span class="nc" id="L532">    calleeNumberInput.setVisible(false);</span>
<span class="nc" id="L533">    calleeLabel.setVisible(false);</span>

<span class="nc" id="L535">    addStartTimeInput.setVisible(true);</span>
<span class="nc" id="L536">    startLabel.setVisible(true);</span>

<span class="nc" id="L538">    addEndTimeInput.setVisible(true);</span>
<span class="nc" id="L539">    endLabel.setVisible(true);</span>

<span class="nc" id="L541">    billResultsTextarea.setVisible(false);</span>
<span class="nc" id="L542">    billResultsTextarea.setValue(&quot;&quot;);</span>
<span class="nc" id="L543">  }</span>

  public void setForPrint () {
<span class="nc" id="L546">    addCallButton.setEnabled(true);</span>
<span class="nc" id="L547">    searchBillButton.setEnabled(true);</span>
<span class="nc" id="L548">    prettyPrintBillButton.setEnabled(false);</span>

<span class="nc" id="L550">    customerNameInput.setVisible(true);</span>
<span class="nc" id="L551">    customerLabel.setVisible(true);</span>

<span class="nc" id="L553">    callerNumberInput.setVisible(false);</span>
<span class="nc" id="L554">    callerLabel.setVisible(false);</span>

<span class="nc" id="L556">    calleeNumberInput.setVisible(false);</span>
<span class="nc" id="L557">    calleeLabel.setVisible(false);</span>

<span class="nc" id="L559">    addStartTimeInput.setVisible(false);</span>
<span class="nc" id="L560">    startLabel.setVisible(false);</span>

<span class="nc" id="L562">    addEndTimeInput.setVisible(false);</span>
<span class="nc" id="L563">    endLabel.setVisible(false);</span>

<span class="nc" id="L565">    billResultsTextarea.setVisible(false);</span>
<span class="nc" id="L566">    billResultsTextarea.setValue(&quot;&quot;);</span>
<span class="nc" id="L567">  }</span>


  public void addCall (ClickEvent clickEvent) {
<span class="nc" id="L571">      logger.info(&quot;Calling setPhoneBill&quot;);</span>

<span class="nc" id="L573">      PhoneCall newCall = textBoxesToPhoneCall();</span>
<span class="nc bnc" id="L574" title="All 2 branches missed.">      if(newCall == null) {</span>
<span class="nc" id="L575">        return;</span>
      }
<span class="nc" id="L577">      String customer = customerNameInput.getValue().trim();</span>

<span class="nc bnc" id="L579" title="All 2 branches missed.">      if(newCall.getEndTime().before(newCall.getStartTime())) {</span>
<span class="nc" id="L580">        alerter.alert(&quot;The end time falls before the start time. Call will not be added.&quot;);</span>
<span class="nc" id="L581">        return;</span>
      }

<span class="nc" id="L584">      phoneBillService.setPhoneBill(customer, newCall, new AsyncCallback&lt;Boolean&gt;() {</span>
          @Override
          public void onFailure(Throwable ex) {
<span class="nc" id="L587">            alertOnException(ex);</span>
<span class="nc" id="L588">          }</span>

          @Override
          public void onSuccess(Boolean callAddSuccess) {
<span class="nc bnc" id="L592" title="All 2 branches missed.">            if(callAddSuccess == true) {</span>
<span class="nc" id="L593">              alerter.alert(&quot;Added the call to &quot; + customer + &quot;'s bill.&quot;);</span>
            }
            else {
<span class="nc" id="L596">              alerter.alert(&quot;This call already exists in the bill, and has not been added.&quot;);</span>
            }
<span class="nc" id="L598">          }</span>
        }
      );
<span class="nc" id="L601">  }</span>


  public void searchBill (ClickEvent clickEvent) {
<span class="nc" id="L605">    Boolean validSearch = validateSearchCall();</span>
<span class="nc bnc" id="L606" title="All 2 branches missed.">    if(validSearch == false) {</span>
<span class="nc" id="L607">      return;</span>
    }

<span class="nc" id="L610">    String customer = customerNameInput.getValue().trim();</span>
<span class="nc" id="L611">    String start = addStartTimeInput.getValue().trim();</span>
<span class="nc" id="L612">    String[] startPieces = start.split(&quot;\\s+&quot;);</span>

<span class="nc" id="L614">    String end = addEndTimeInput.getValue().trim();</span>
<span class="nc" id="L615">    String[] endPieces = end.split(&quot;\\s+&quot;);</span>

<span class="nc" id="L617">    logger.info(&quot;Calling getPhoneBill&quot;);</span>
<span class="nc" id="L618">    phoneBillService.getBill(customer, new AsyncCallback&lt;PhoneBill&gt;() {</span>

      @Override
      public void onFailure(Throwable ex) {
<span class="nc" id="L622">        alertOnException(ex);</span>
<span class="nc" id="L623">      }</span>

      @Override
      public void onSuccess(PhoneBill phoneBill) {
<span class="nc bnc" id="L627" title="All 2 branches missed.">        if(phoneBill != null) {</span>


<span class="nc" id="L630">          PhoneBill subBill = phoneBill.searchCalls(customer,PhoneCall.stringToDate(startPieces[0], startPieces[1], startPieces[2]), PhoneCall.stringToDate(endPieces[0], endPieces[1], endPieces[2]));</span>

<span class="nc bnc" id="L632" title="All 2 branches missed.">          if(subBill.getPhoneCalls().size() == 0) {</span>
<span class="nc" id="L633">            billResultsTextarea.setVisible(true);</span>
<span class="nc" id="L634">            billResultsTextarea.setValue(&quot;No calls fall within those times.&quot;);</span>
<span class="nc" id="L635">            return;</span>
          }

<span class="nc" id="L638">          String prettyPrint = subBill.prettyPrintCalls(subBill, &quot;Search Results: &quot;);</span>
<span class="nc" id="L639">          billResultsTextarea.setVisible(true);</span>
<span class="nc" id="L640">          billResultsTextarea.setValue(prettyPrint);</span>
          //alerter.alert(prettyPrint);
<span class="nc" id="L642">        }</span>
        else {
<span class="nc" id="L644">          alerter.alert(&quot;That customer doesn't exist.&quot;);</span>
        }
<span class="nc" id="L646">      }</span>
    });
<span class="nc" id="L648">  }</span>

  public void printBill (ClickEvent clickEvent) {
<span class="nc" id="L651">    logger.info(&quot;Calling getPhoneBill to print&quot;);</span>
<span class="nc" id="L652">    Boolean customerValid = validatePrintCall();</span>
<span class="nc bnc" id="L653" title="All 2 branches missed.">    if(customerValid == false) {</span>
<span class="nc" id="L654">      return;</span>
    }

<span class="nc" id="L657">    String customer = customerNameInput.getValue().trim();</span>

<span class="nc" id="L659">    phoneBillService.getBill(customer, new AsyncCallback&lt;PhoneBill&gt;() {</span>

      @Override
      public void onFailure(Throwable ex) {
<span class="nc" id="L663">        alertOnException(ex);</span>
<span class="nc" id="L664">      }</span>

      @Override
      public void onSuccess(PhoneBill bill) {
<span class="nc bnc" id="L668" title="All 2 branches missed.">        if(bill == null) {</span>
<span class="nc" id="L669">          alerter.alert(&quot;That customer doesn't exist&quot;);</span>
<span class="nc" id="L670">          return;</span>
        }
<span class="nc" id="L672">        String prettyBill = bill.prettyPrintCalls(bill, &quot;Bill for: &quot;+bill.getCustomer());</span>
<span class="nc" id="L673">        billResultsTextarea.setVisible(true);</span>
<span class="nc" id="L674">        billResultsTextarea.setValue(prettyBill);</span>
      //  alerter.alert(prettyBill);
<span class="nc" id="L676">      }</span>
    });

<span class="nc" id="L679">  }</span>

  public PhoneCall textBoxesToPhoneCall () {
<span class="nc" id="L682">    Boolean validCall = validateNewCall();</span>
<span class="nc bnc" id="L683" title="All 2 branches missed.">    if(validCall == false) {</span>
<span class="nc" id="L684">      return null;</span>
    }
<span class="nc" id="L686">    PhoneCall call = new PhoneCall();</span>

<span class="nc" id="L688">    String caller = callerNumberInput.getValue().trim();</span>
<span class="nc" id="L689">    Boolean callerCorrect = call.setCaller(caller);</span>

<span class="nc" id="L691">    String callee = calleeNumberInput.getValue().trim();</span>
<span class="nc" id="L692">    Boolean calleeCorrect = call.setCallee(callee);</span>

<span class="nc" id="L694">    String start = addStartTimeInput.getValue().trim();</span>
<span class="nc" id="L695">    String[] startPieces = start.split(&quot;\\s+&quot;);</span>
<span class="nc" id="L696">    Boolean startCorrect = call.setStartTimeString(startPieces[0], startPieces[1], startPieces[2]);</span>

<span class="nc" id="L698">    String end = addEndTimeInput.getValue().trim();</span>
<span class="nc" id="L699">    String[] endPieces = end.split(&quot;\\s+&quot;);</span>
<span class="nc" id="L700">    Boolean endCorrect = call.setEndTimeString(endPieces[0], endPieces[1], endPieces[2]);</span>

<span class="nc" id="L702">    String errorMessage = &quot;&quot;;</span>

<span class="nc bnc" id="L704" title="All 2 branches missed.">    if(callerCorrect == false) {</span>
<span class="nc" id="L705">      errorMessage += &quot;Caller Number is not formatted correctly.\n&quot;;</span>
    }
<span class="nc bnc" id="L707" title="All 2 branches missed.">    if(calleeCorrect == false) {</span>
<span class="nc" id="L708">      errorMessage += &quot;Callee Number is not formatted correctly.\n&quot;;</span>
    }
<span class="nc bnc" id="L710" title="All 2 branches missed.">    if(startCorrect == false) {</span>
<span class="nc" id="L711">      errorMessage += &quot;Start Time is not formatted correctly.\n&quot;;</span>
    }
<span class="nc bnc" id="L713" title="All 2 branches missed.">    if(endCorrect == false) {</span>
<span class="nc" id="L714">      errorMessage += &quot;End Time is not formatted correctly.\n&quot;;</span>
    }

<span class="nc bnc" id="L717" title="All 2 branches missed.">    if(errorMessage.equals(&quot;&quot;) == false) {</span>
<span class="nc" id="L718">      alerter.alert(errorMessage);</span>
<span class="nc" id="L719">      return null;</span>
    }

<span class="nc" id="L722">    return call;</span>
  }

  public Boolean validateNewCall () {
<span class="nc" id="L726">    String invalidMessage = &quot;&quot;;</span>

<span class="nc bnc" id="L728" title="All 2 branches missed.">    if(customerNameInput.getValue().equals(&quot;&quot;)) {</span>
<span class="nc" id="L729">      invalidMessage += &quot;Customer is empty.\n&quot;;</span>
    }

<span class="nc bnc" id="L732" title="All 2 branches missed.">    if(callerNumberInput.getValue().equals(&quot;&quot;)) {</span>
<span class="nc" id="L733">      invalidMessage += &quot;Caller number is empty.\n&quot;;</span>
    }

<span class="nc bnc" id="L736" title="All 2 branches missed.">    if(calleeNumberInput.getValue().equals(&quot;&quot;)) {</span>
<span class="nc" id="L737">      invalidMessage += &quot;Callee number is empty.\n&quot;;</span>
    }

<span class="nc bnc" id="L740" title="All 2 branches missed.">    if(addStartTimeInput.getValue().equals(&quot;&quot;)) {</span>
<span class="nc" id="L741">      invalidMessage += &quot;Start time is empty.\n&quot;;</span>
    }

<span class="nc bnc" id="L744" title="All 2 branches missed.">    if(addEndTimeInput.getValue().equals(&quot;&quot;)) {</span>
<span class="nc" id="L745">      invalidMessage += &quot;End time is empty.\n&quot;;</span>
    }

<span class="nc bnc" id="L748" title="All 2 branches missed.">    if(invalidMessage.equals(&quot;&quot;) == false) {</span>
<span class="nc" id="L749">      alerter.alert(invalidMessage);</span>
<span class="nc" id="L750">      return false;</span>
    }

<span class="nc" id="L753">    return true;</span>
  }

  public Boolean validateSearchCall () {
<span class="nc" id="L757">    String invalidMessage = &quot;&quot;;</span>

<span class="nc" id="L759">    String customer = customerNameInput.getValue();</span>
<span class="nc bnc" id="L760" title="All 2 branches missed.">    if(customer.equals(&quot;&quot;)) {</span>
<span class="nc" id="L761">      invalidMessage += &quot;Customer is empty.\n&quot;;</span>
    }

<span class="nc" id="L764">    String start = addStartTimeInput.getValue();</span>
<span class="nc bnc" id="L765" title="All 2 branches missed.">    if(start.equals(&quot;&quot;)) {</span>
<span class="nc" id="L766">      invalidMessage += &quot;Start time is empty.\n&quot;;</span>
    }

<span class="nc" id="L769">    String end = addEndTimeInput.getValue();</span>
<span class="nc bnc" id="L770" title="All 2 branches missed.">    if(end.equals(&quot;&quot;)) {</span>
<span class="nc" id="L771">      invalidMessage += &quot;End time is empty.\n&quot;;</span>
    }

<span class="nc bnc" id="L774" title="All 2 branches missed.">    if(invalidMessage.equals(&quot;&quot;) == false) {</span>
<span class="nc" id="L775">      alerter.alert(invalidMessage);</span>
<span class="nc" id="L776">      return false;</span>
    }

<span class="nc" id="L779">    return true;</span>
  }

  public Boolean validatePrintCall () {
<span class="nc" id="L783">    String invalidMessage = &quot;&quot;;</span>

<span class="nc" id="L785">    String customer = customerNameInput.getValue();</span>
<span class="nc bnc" id="L786" title="All 2 branches missed.">    if(customer.equals(&quot;&quot;)) {</span>
<span class="nc" id="L787">      invalidMessage += &quot;Customer is empty.\n&quot;;</span>
    }

<span class="nc bnc" id="L790" title="All 2 branches missed.">    if(invalidMessage.equals(&quot;&quot;) == false) {</span>
<span class="nc" id="L791">      alerter.alert(invalidMessage);</span>
<span class="nc" id="L792">      return false;</span>
    }

<span class="nc" id="L795">    return true;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>